<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fire-Mining ‚Äî Final Fix</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg1:#071122; --bg2:#081426; --accent:#00f2ff; --accent2:#8b5cf6;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(800px 400px at 10% 10%, rgba(139,92,246,0.06), transparent 8%),
                  radial-gradient(700px 300px at 90% 90%, rgba(0,242,255,0.04), transparent 8%),
                  linear-gradient(180deg,var(--bg1),var(--bg2));
      color:#e6eef8;
      display:flex;
      flex-direction:column;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      height:100vh;
      overflow:hidden;
    }
    .glass {background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));
      border: 1px solid rgba(255,255,255,0.04); backdrop-filter: blur(8px);
      border-radius:12px; box-shadow: 0 10px 30px rgba(0,0,0,0.45);}
    .app { display:flex; flex-direction:column; height:100%; }
    .page { position:absolute; inset:18px; border-radius:14px; overflow:hidden;
      transition:transform .45s, opacity .35s ease; opacity:0; transform: translateY(8px) scale(.995);
      pointer-events:none; display:flex; align-items:center; justify-content:center; }
    .page.active { opacity:1; transform: translateY(0) scale(1); pointer-events:auto; }
    .tabbar { position:fixed; left:50%; transform:translateX(-50%); bottom:22px;
      width:calc(100% - 40px); max-width:980px; display:none; gap:8px; align-items:center;
      justify-content:center; padding:10px; background:rgba(0,0,0,0.32); border-radius:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.45); z-index:999;}
    .tab { padding:8px 12px; border-radius:10px; display:flex; gap:8px; align-items:center;
      cursor:pointer; transition:all .28s ease; color:rgba(255,255,255,0.88);}
    .tab.active { background:linear-gradient(90deg, rgba(0,242,255,0.06), rgba(139,92,246,0.04));
      transform:translateY(-4px); box-shadow:0 12px 30px rgba(0,0,0,0.45);}
    .auth-wrap { width:420px; max-width:92vw; }
    .field { width:100%; padding:.6rem; border-radius:8px;
      border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.02);
      color:#e6eef8; margin-bottom:8px; }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header flex items-center justify-between p-4">
      <div class="logo flex items-center gap-2">
        <div class="dot w-2 h-2 rounded-full bg-cyan-400"></div>
        <h1 class="font-bold">Fire-Mining</h1>
      </div>
      <div id="headerUser" class="text-sm opacity-80">Guest</div>
    </header>

    <main class="pages">
      <!-- AUTH -->
      <section id="authPage" class="page active">
        <div class="glass auth-wrap p-6">
          <h2 class="text-lg font-semibold mb-3 text-center">Masuk atau Daftar</h2>
          <div class="flex gap-3 mb-4">
            <button id="btnShowLogin" class="btn w-full">Login</button>
            <button id="btnShowRegister" class="btn w-full">Register</button>
          </div>
          <!-- LOGIN -->
          <div id="loginBlock">
            <input id="loginEmail" class="field" type="email" placeholder="Email" />
            <input id="loginUsername" class="field" type="text" placeholder="Username" />
            <input id="loginPassword" class="field" type="password" placeholder="Kata sandi" />
            <button id="btnLogin" class="btn btn-start w-full mt-3">Login</button>
          </div>
          <!-- REGISTER -->
          <div id="registerBlock" style="display:none;">
            <input id="regEmail" class="field" type="email" placeholder="Email" />
            <input id="regUsername" class="field" type="text" placeholder="Username" />
            <input id="regPassword" class="field" type="password" placeholder="Kata sandi" />
            <button id="btnRegister" class="btn w-full mt-2">Daftar</button>
          </div>
        </div>
      </section>

      <!-- HOME -->
      <section id="homePage" class="page">
        <div class="glass p-6 w-full max-w-xl">
          <h3 class="text-lg font-semibold mb-2">Selamat datang</h3>
          <p class="text-sm opacity-70 mb-4">Tonton iklan untuk mendapatkan bonus</p>
          <div class="mini-card glass mx-auto mb-4">
            <iframe src="https://iklan-giga-hub.vercel.app/" 
                    style="width:100%;height:250px;border:none;border-radius:12px;">
            </iframe>
          </div>
          <div class="flex gap-3">
            <button class="btn" onclick="window.open('https://iklan-giga-hub.vercel.app/','_blank')">
              üé• Tonton Iklan
            </button>
            <button class="btn" onclick="showPage('miningPage')">‚õèÔ∏è Ke Mining</button>
          </div>
        </div>
      </section>

      <!-- MINING -->
      <section id="miningPage" class="page">
        <div class="glass p-6 w-full max-w-xl">
          <h3 class="text-lg font-semibold mb-2">Mining 24 Jam</h3>
          <div class="progress-bar w-full h-3 bg-gray-700 rounded overflow-hidden">
            <div id="progressFill" class="progress-fill bg-cyan-400 h-3" style="width:0%" data-val="0"></div>
          </div>
          <p class="text-sm mt-2">Unclaimed: <span id="unclaimed">0.000000</span> KOT</p>
          <p class="text-sm mt-1">Sisa waktu: <span id="timeLeft">24:00:00</span></p>
          <div class="mt-3 flex gap-2">
            <button id="claimBtn" class="btn">Claim</button>
          </div>
        </div>
      </section>

      <!-- WALLET -->
      <section id="walletPage" class="page">
        <div class="glass p-6 w-full max-w-xl text-center">
          <h3 class="text-lg font-semibold mb-2">Wallet</h3>
          <div id="walletBalance" class="text-2xl font-mono">0.000000</div>
        </div>
      </section>

      <!-- PROFILE -->
      <section id="profilePage" class="page">
        <div class="glass p-6 w-full max-w-xl text-center">
          <h3 class="text-lg font-semibold mb-4">Profile</h3>
          <div id="profileEmail" class="mb-2"></div>
          <div id="profileName" class="mb-4"></div>
          <button onclick="logout()" class="btn btn-stop w-full">Logout</button>
        </div>
      </section>
    </main>

    <!-- TABBAR -->
    <nav id="tabbar" class="tabbar">
      <div class="tab active" data-page="homePage" onclick="onTabClick(event)">üè† Home</div>
      <div class="tab" data-page="miningPage" onclick="onTabClick(event)">‚õèÔ∏è Mining</div>
      <div class="tab" data-page="walletPage" onclick="onTabClick(event)">üí∞ Wallet</div>
      <div class="tab" data-page="profilePage" onclick="onTabClick(event)">üë§ Profile</div>
    </nav>
  </div>

  <script>
    let miningInterval=null, timerInterval=null;
    let unclaimed=0, balance=0;
    const miningDuration=24*60*60; // 24 jam (detik)
    let remainingTime=miningDuration;

    // REGISTER
    document.getElementById('btnRegister').addEventListener('click', ()=>{
      const e=document.getElementById('regEmail').value.trim();
      const u=document.getElementById('regUsername').value.trim();
      const p=document.getElementById('regPassword').value;
      if(!e||!u||!p) return alert('Lengkapi semua field!');
      const key='user_'+u.toLowerCase();
      if(localStorage.getItem(key)) return alert('Username sudah terdaftar!');
      localStorage.setItem(key, JSON.stringify({email:e,username:u,password:p,balance:0}));
      alert('Registrasi berhasil! Silakan login.');
      document.getElementById('btnShowLogin').click();
    });

    // LOGIN
    document.getElementById('btnLogin').addEventListener('click', ()=>{
      const e=document.getElementById('loginEmail').value.trim();
      const u=document.getElementById('loginUsername').value.trim();
      const p=document.getElementById('loginPassword').value;
      if(!e||!u||!p) return alert('Lengkapi semua field!');
      const key='user_'+u.toLowerCase();
      const stored=localStorage.getItem(key);
      if(stored){
        const data=JSON.parse(stored);
        if(data.password!==p) return alert('Password salah!');
        localStorage.setItem('auth_user', u.toLowerCase());
        localStorage.setItem('email', data.email);
        localStorage.setItem('username', data.username);
        localStorage.setItem('balance', data.balance||0);
        onAppStart();
        startMiningCycle();
      } else {
        alert('Akun tidak ditemukan, silakan daftar!');
      }
    });

    // Tabs
    function onTabClick(e){showPage(e.currentTarget.dataset.page)}
    function showPage(id){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.page===id));
    }

    // Mining logic 24 jam background
    function startMiningCycle(){
      if(miningInterval) return;
      remainingTime=miningDuration;
      timerInterval=setInterval(()=>{
        remainingTime--;
        updateTimer();
        unclaimed+=0.00002;
        document.getElementById('unclaimed').innerText=unclaimed.toFixed(6);
        let progress=(1-(remainingTime/miningDuration))*100;
        document.getElementById('progressFill').style.width=progress+'%';
        if(remainingTime<=0){
          stopMining();
        }
      },1000);
    }
    function stopMining(){
      clearInterval(timerInterval);timerInterval=null;
      miningInterval=null;
    }
    function updateTimer(){
      let h=Math.floor(remainingTime/3600);
      let m=Math.floor((remainingTime%3600)/60);
      let s=remainingTime%60;
      document.getElementById('timeLeft').innerText=
        String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
    }
    document.getElementById('claimBtn').addEventListener('click', ()=>{
      if(unclaimed<=0)return alert("Tidak ada saldo unclaimed");
      balance+=unclaimed;unclaimed=0;
      updateUI();
      alert('Claim berhasil! Mining dimulai lagi.');
      startMiningCycle(); // otomatis jalan lagi
    });

    function updateUI(){
      document.getElementById('walletBalance').innerText=balance.toFixed(6);
      document.getElementById('unclaimed').innerText=unclaimed.toFixed(6);
      localStorage.setItem('balance', balance);
    }

    function onAppStart(){
      const auth=localStorage.getItem('auth_user');
      const user=localStorage.getItem('username');
      const email=localStorage.getItem('email');
      balance=parseFloat(localStorage.getItem('balance')||'0');
      if(auth&&user){
        document.getElementById('authPage').classList.remove('active');
        document.getElementById('homePage').classList.add('active');
        document.getElementById('profileEmail').innerText=email;
        document.getElementById('profileName').innerText=user;
        document.getElementById('headerUser').innerText=user;
        document.getElementById('tabbar').style.display='flex';
        updateUI();
      } else {
        document.getElementById('authPage').classList.add('active');
        document.getElementById('tabbar').style.display='none';
      }
    }

    function logout(){localStorage.clear();location.reload();}

    // Toggle login/register
    document.getElementById('btnShowLogin').addEventListener('click',()=>{
      document.getElementById('loginBlock').style.display='';
      document.getElementById('registerBlock').style.display='none';
    });
    document.getElementById('btnShowRegister').addEventListener('click',()=>{
      document.getElementById('loginBlock').style.display='none';
      document.getElementById('registerBlock').style.display='';
    });

    window.addEventListener('load',()=>{onAppStart();});
  </script>
</body>
</html>
