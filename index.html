<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fire-Mining Debug</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div class="p-6 max-w-md mx-auto">
    <h2 class="text-lg font-semibold mb-3">Login / Register Debug</h2>

    <!-- LOGIN -->
    <div id="loginBlock">
      <input id="loginEmail" class="border p-2 w-full mb-2" type="email" placeholder="Email" />
      <input id="loginUsername" class="border p-2 w-full mb-2" type="text" placeholder="Username" />
      <input id="loginPassword" class="border p-2 w-full mb-2" type="password" placeholder="Password" />
      <button id="btnLogin" class="bg-blue-500 text-white px-4 py-2 rounded">Login</button>
    </div>

    <!-- REGISTER -->
    <div id="registerBlock" class="mt-6">
      <input id="regEmail" class="border p-2 w-full mb-2" type="email" placeholder="Email" />
      <input id="regUsername" class="border p-2 w-full mb-2" type="text" placeholder="Username" />
      <input id="regPassword" class="border p-2 w-full mb-2" type="password" placeholder="Password" />
      <button id="btnRegister" class="bg-green-500 text-white px-4 py-2 rounded">Register</button>
    </div>
  </div>

  <!-- Firebase v9 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    // ======== GANTI DENGAN CONFIG PROJECT ANDA ========
    const firebaseConfig = {
  apiKey: "AIzaSyCc4ix1uGCaE-rsyM6Lg3jo6SzVjbXYCmw",
  authDomain: "crypto-mining-d3811.firebaseapp.com",
  databaseURL: "https://crypto-mining-d3811-default-rtdb.firebaseio.com",
  projectId: "crypto-mining-d3811",
  storageBucket: "crypto-mining-d3811.firebasestorage.app",
  messagingSenderId: "1068882455445",
  appId: "1:1068882455445:web:037fead0336694428f649c"
};
    // ===============================================

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ===== Register =====
    document.getElementById('btnRegister').addEventListener('click', async ()=>{
      const email = document.getElementById('regEmail').value.trim();
      const username = document.getElementById('regUsername').value.trim();
      const password = document.getElementById('regPassword').value;

      console.log("👉 Register ditekan:", email, username);

      if(!email || !username || !password) {
        alert("Lengkapi semua field!");
        return;
      }

      try {
        const userRef = ref(db, 'users/'+username);
        const snap = await get(userRef);
        if(snap.exists()) {
          console.warn("❌ Username sudah ada:", username);
          alert("Username sudah terdaftar!");
          return;
        }

        await set(userRef, {
          email, username, password, balance:0, miningActive:false,
          miningStartTime:0, history:[], totalClaim:0
        });

        console.log("✅ Registrasi berhasil:", username);
        alert("Registrasi berhasil! Silakan login.");
      } catch (err) {
        console.error("🔥 Error register:", err);
        alert("Error register: "+err.message);
      }
    });

    // ===== Login =====
    document.getElementById('btnLogin').addEventListener('click', async ()=>{
      console.log("👉 Tombol Login ditekan");

      const email = document.getElementById('loginEmail').value.trim();
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;

      if(!email || !username || !password) {
        alert("Lengkapi semua field!");
        return;
      }

      try {
        const snap = await get(ref(db, 'users/'+username));
        console.log("🔎 Hasil query user:", snap.exists(), snap.val());

        if(!snap.exists()) {
          alert("Akun tidak ditemukan!");
          return;
        }

        const user = snap.val();
        if(user.password !== password) {
          console.warn("❌ Password salah, input:", password, "stored:", user.password);
          alert("Password salah!");
          return;
        }

        console.log("✅ Login sukses:", username);
        alert("Login sukses, selamat datang "+username);

      } catch (err) {
        console.error("🔥 Error login:", err);
        alert("Error login: "+err.message);
      }
    });
  </script>
</body>
</html>
