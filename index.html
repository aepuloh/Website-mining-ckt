<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nickt Lite Mining</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
    <script src="https://unpkg.com/lucide-react/dist/umd/lucide-react.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-neutral-950 text-neutral-100">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;
      const { motion, AnimatePresence } = window['framer-motion'];
      const { PlayCircle, Square, Gift, Coins, Users, Link: LinkIcon, LogIn, LogOut, ChevronRight, Copy, Check, Wallet, Settings } = lucideReact;

      const cn = (...c) => c.filter(Boolean).join(" ");
      const fmt = (n) => Number(n || 0).toLocaleString("id-ID", { maximumFractionDigits: 8 });
      const now = () => Date.now();
      const uid = () => Math.random().toString(36).slice(2, 10);

      const useHashRoute = () => {
        const [hash, setHash] = useState(() => window.location.hash || "#/home");
        useEffect(() => {
          const onHash = () => setHash(window.location.hash || "#/home");
          window.addEventListener("hashchange", onHash);
          return () => window.removeEventListener("hashchange", onHash);
        }, []);
        const path = hash.split("?")[0];
        const params = useMemo(() => new URLSearchParams(hash.split("?")[1] || ""), [hash]);
        return { path, params, push: (p) => (window.location.hash = p) };
      };

      const KEYS = {
        users: "app.users",
        session: "app.session",
        wallet: (uid) => `wallet.${uid}`,
      };

      const read = (k, d) => {
        try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch { return d; }
      };
      const write = (k, v) => localStorage.setItem(k, JSON.stringify(v));

      const useMiner = (active, baseHash = 12.5, boost = 1) => {
        const [earned, setEarned] = useState(0);
        const lastRef = useRef(now());
        useEffect(() => {
          if (!active) return;
          const t = setInterval(() => {
            const tnow = now();
            const dt = (tnow - lastRef.current) / 1000;
            lastRef.current = tnow;
            const rate = (baseHash * boost) / 1_000_000_000;
            setEarned((e) => e + dt * rate);
          }, 1000);
          return () => clearInterval(t);
        }, [active, baseHash, boost]);
        useEffect(() => { lastRef.current = now(); }, [active]);
        return earned;
      };

      const CopyButton = ({ value }) => {
        const [ok, setOk] = useState(false);
        return (
          <button onClick={async () => {
            try { await navigator.clipboard.writeText(value); setOk(true); setTimeout(() => setOk(false), 1200); } catch {}
          }} className="inline-flex items-center gap-1 rounded-xl px-3 py-2 bg-neutral-900 text-white text-xs">
            {ok ? <Check size={16} /> : <Copy size={16} />} {ok ? "Disalin" : "Salin"}
          </button>
        );
      };

      function App(){
        const router = useHashRoute();
        const { path, params, push } = router;
        const refFromUrl = useMemo(() => params.get("ref") || "", [params]);
        const [users, setUsers] = useState(() => read(KEYS.users, []));
        const [session, setSession] = useState(() => read(KEYS.session, null));
        const me = users.find((u) => u.id === session?.uid);
        useEffect(() => write(KEYS.users, users), [users]);
        useEffect(() => write(KEYS.session, session), [session]);
        const [wallet, setWallet] = useState(() => (me ? read(KEYS.wallet(me.id), {balance:0,totalMined:0,lastBonus:0,hashrate:12.5,mining:false,boosts:1}) : null));
        useEffect(() => { if(me) setWallet(read(KEYS.wallet(me.id), {balance:0,totalMined:0,lastBonus:0,hashrate:12.5,mining:false,boosts:1})); }, [me?.id]);
        useEffect(() => { if(me&&wallet) write(KEYS.wallet(me.id), wallet); }, [me?.id, wallet]);
        const earned = useMiner(wallet?.mining, wallet?.hashrate, wallet?.boosts);
        useEffect(() => { if(!me||!wallet) return; const i=setInterval(()=>{ setWallet((w)=>({...w,balance:w.balance+earned,totalMined:w.totalMined+earned}));},3000); return()=>clearInterval(i); },[earned,me,wallet?.mining]);

        const [regRef, setRegRef] = useState("");
        useEffect(()=>{if(path==="#/reg") setRegRef(refFromUrl);},[path,refFromUrl]);

        const handleRegister=(e)=>{e.preventDefault(); const fd=new FormData(e.currentTarget); const name=fd.get("name").trim(); const email=fd.get("email").trim(); const pass=fd.get("password"); const ref=fd.get("ref").trim(); if(!name||!email||!pass)return alert("Lengkapi semua field."); if(users.some(u=>u.email.toLowerCase()===email.toLowerCase()))return alert("Email sudah terdaftar."); const id=uid(); const newUser={id,name,email,referrer:ref||null,createdAt:now()}; const newUsers=[...users,newUser]; setUsers(newUsers); setSession({uid:id}); write(KEYS.wallet(id),{balance:0,totalMined:0,lastBonus:0,hashrate:12.5,mining:false,boosts:1}); if(ref){const refUser=newUsers.find((u)=>u.name===ref||u.email===ref||u.id===ref); if(refUser){const wk=KEYS.wallet(refUser.id); const rw=read(wk,{balance:0}); rw.balance=(rw.balance||0)+0.01; write(wk,rw);}} push("#/dashboard"); };

        const handleLogin=(e)=>{e.preventDefault(); const fd=new FormData(e.currentTarget); const email=fd.get("email").trim(); const u=users.find((x)=>x.email.toLowerCase()===email.toLowerCase()); if(!u) return alert("Akun tidak ditemukan."); setSession({uid:u.id}); push("#/dashboard"); };
        const logout=()=>{setSession(null); push("#/home");};
        const referralLink=useMemo(()=>{if(!me)return"";const base=window.location.href.split("#")[0];return `${base}#/reg?ref=${encodeURIComponent(me.name)}`;},[me]);

        return <div className="min-h-screen bg-gradient-to-b from-neutral-950 via-neutral-900 to-neutral-950 text-neutral-100">
          <div className="p-4 flex justify-between items-center border-b border-white/5">
            <div className="flex items-center gap-2"><Coins className="text-yellow-400"/> <span className="font-bold">Nickt Lite</span></div>
            <div className="flex gap-2">{me?<><button onClick={()=>push("#/dashboard")} className="px-3 py-2 bg-white/10 rounded">Dashboard</button><button onClick={logout} className="px-3 py-2 bg-red-600 rounded text-white">Keluar</button></>:<><button onClick={()=>push("#/reg")} className="px-3 py-2 bg-yellow-400 text-black rounded">Daftar</button><button onClick={()=>push("#/login")} className="px-3 py-2 bg-white/10 rounded">Masuk</button></>}</div>
          </div>
          <main className="max-w-3xl mx-auto p-4">
            {path==="#/home"&&<div className="text-center space-y-4"><h1 className="text-3xl font-bold">Bentuk Tim & Hasilkan <span className="text-yellow-400">Penghasilan</span></h1><button onClick={()=>push("#/reg")} className="px-4 py-2 bg-yellow-400 rounded text-black">Mulai Sekarang</button></div>}
            {path==="#/reg"&&<form onSubmit={handleRegister} className="space-y-3"><input name="name" placeholder="Nama" className="w-full p-2 rounded bg-black/30" required/><input name="email" placeholder="Email" className="w-full p-2 rounded bg-black/30" required/><input name="password" type="password" placeholder="Password" className="w-full p-2 rounded bg-black/30" required/><input name="ref" value={regRef} onChange={(e)=>setRegRef(e.target.value)} placeholder="Referal" className="w-full p-2 rounded bg-black/30"/><button className="px-4 py-2 bg-yellow-400 rounded text-black w-full">Daftar</button></form>}
            {path==="#/login"&&<form onSubmit={handleLogin} className="space-y-3"><input name="email" placeholder="Email" className="w-full p-2 rounded bg-black/30" required/><button className="px-4 py-2 bg-yellow-400 rounded text-black w-full">Masuk</button></form>}
            {path==="#/dashboard"&&me&&wallet&&<div className="space-y-4"><h2 className="text-xl font-bold">Halo, {me.name}</h2><div className="p-4 bg-white/5 rounded"><div>Saldo: {fmt(wallet.balance)} NKT</div><div>Total mined: {fmt(wallet.totalMined)} NKT</div><button onClick={()=>setWallet({...wallet,mining:!wallet.mining})} className="mt-2 px-4 py-2 bg-emerald-500 rounded text-white">{wallet.mining?"Stop":"Mulai Mining"}</button></div><div className="p-4 bg-white/5 rounded space-y-2"><div>Link referal:</div><div className="break-all text-xs">{referralLink}</div><CopyButton value={referralLink}/></div></div>}
          </main>
        </div>
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
    </script>
  </body>
</html>
